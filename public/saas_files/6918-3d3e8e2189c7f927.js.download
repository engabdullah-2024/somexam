"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6918],{9282:(e,s,o)=>{o.d(s,{ZF:()=>t.ZF,vz:()=>v,Wn:()=>y,LR:()=>u,_e:()=>m,M7:()=>c,GW:()=>p,FB:()=>d,tP:()=>h});var t=o(77915),r=o(96918),i=o(5041),n=o(26715),a=o(35695),l=o(56671);function u(){return(0,i.n)({mutationFn:async e=>{let{data:s}=await r.A.post("/auth/register",e);return s}})}function d(){return(0,i.n)({mutationFn:async e=>{let{data:s}=await r.A.post("/auth/verify-email",{token:e});return s}})}function c(){return(0,i.n)({mutationFn:async e=>{let{data:s}=await r.A.post("/auth/resend-verification",{email:e});return s}})}function v(){let e=(0,n.jE)(),s=(0,a.useRouter)();return(0,i.n)({mutationFn:async s=>{try{let{data:o}=await r.A.post("/auth/login",{...s,deviceInfo:{userAgent:navigator.userAgent,ip:"0.0.0.0"}});return o.requiresVerification&&localStorage.setItem("temp_credentials",JSON.stringify(s)),o.sessionId&&(s.remember?localStorage.setItem("sessionId",o.sessionId):sessionStorage.setItem("sessionId",o.sessionId)),o.user&&!o.requiresVerification&&(e.setQueryData(t.ZF.session(),{user:o.user}),e.invalidateQueries({queryKey:t.ZF.session(),refetchType:"all"})),o}catch(e){var o,i,n,a;if((null==e?void 0:null===(o=e.response)||void 0===o?void 0:o.status)===401&&(null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(n=a.data)||void 0===n?void 0:null===(i=n.message)||void 0===i?void 0:i.includes("verify your email")))throw localStorage.setItem("unverified_email",s.email),Error("EMAIL_NOT_VERIFIED");throw e}},onSuccess:async(o,r)=>{if(o.user&&!o.requiresVerification){await Promise.all([e.invalidateQueries({queryKey:t.ZF.session(),refetchType:"all"}),e.invalidateQueries({queryKey:["session"],refetchType:"all"})]),await e.refetchQueries({queryKey:t.ZF.session()}),l.o.success("Welcome back, ".concat(o.user.firstName,"!"));let i=r.callbackUrl||"/dashboard";s.push(i)}else o.requiresVerification&&s.push("/auth/verify-email?email=".concat(encodeURIComponent(r.email)));o.user&&!o.requiresVerification&&e.invalidateQueries({queryKey:t.ZF.session(),refetchType:"all"})},onError:e=>{l.o.error(e.message)}})}function h(){let e=(0,n.jE)();return(0,i.n)({mutationFn:async s=>{try{let{data:o}=await r.A.post("/auth/verify-code",{code:s.code},{headers:{"X-Session-ID":s.sessionId}});return o.sessionId&&localStorage.setItem("sessionId",o.sessionId),o.user&&(e.setQueryData(t.ZF.session(),{user:o.user}),e.invalidateQueries({queryKey:t.ZF.session()})),o}catch(e){var o,i,n,a;if((null==e?void 0:null===(o=e.response)||void 0===o?void 0:o.status)===401&&(null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(n=a.data)||void 0===n?void 0:null===(i=n.message)||void 0===i?void 0:i.includes("session expired")))throw Error("Your verification session has expired. Please try logging in again.");throw e}},onSuccess:()=>{localStorage.removeItem("temp_credentials")},retry:!1})}function m(){return(0,i.n)({mutationFn:async()=>{let e=localStorage.getItem("sessionId")||sessionStorage.getItem("sessionId");if(!e)throw Error("No active session found");let s=localStorage.getItem("deviceId")||crypto.randomUUID();localStorage.setItem("deviceId",s);try{let{data:o}=await r.A.post("/auth/request-verification",{deviceId:s,userAgent:navigator.userAgent},{headers:{"X-Session-ID":e}});return o.sessionId&&(localStorage.setItem("sessionId",o.sessionId),sessionStorage.setItem("sessionId",o.sessionId)),o}catch(e){var o;if((null==e?void 0:null===(o=e.response)||void 0===o?void 0:o.status)===401)throw localStorage.removeItem("sessionId"),localStorage.removeItem("deviceId"),sessionStorage.removeItem("sessionId"),Error("Your verification session has expired. Please try logging in again.");throw e}},onError:e=>{var s;throw(null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.status)===401&&(localStorage.removeItem("sessionId"),localStorage.removeItem("deviceId"),sessionStorage.removeItem("sessionId")),e},retry:0})}function y(){let e=(0,n.jE)();return(0,i.n)({mutationFn:async()=>{let e=localStorage.getItem("sessionId"),{data:s}=await r.A.post("/auth/logout",{},{headers:e?{"X-Session-ID":e}:void 0,withCredentials:!0});return s},onSuccess:async()=>{localStorage.clear(),sessionStorage.clear(),await Promise.all([e.invalidateQueries({queryKey:t.ZF.session(),refetchType:"all"}),e.invalidateQueries({queryKey:["session"],refetchType:"all"})]),e.setQueryData(t.ZF.session(),{user:null}),e.setQueryData(["session"],{user:null}),e.clear(),document.cookie="XSRF-TOKEN=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="_csrf=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",l.o.success("Logged out successfully")},onError:e=>{l.o.error(e.message||"Logout failed")}})}let p=()=>{let e=(0,n.jE)();return(0,i.n)({mutationFn:async e=>(await r.A.post("/auth/switch-role",{role:e})).data,onSuccess:s=>{e.invalidateQueries({queryKey:["auth"]}),e.invalidateQueries({queryKey:["session"]}),l.o.success("Switched to ".concat(s.data.activeRole," role successfully")),window.location.href=({student:"/dashboard/student",instructor:"/dashboard/instructor",admin:"/dashboard/admin",superadmin:"/dashboard/admin",marketer:"/dashboard/marketer",mentor:"/dashboard/mentor",communicator:"/dashboard/mentor"})[s.data.activeRole]||"/dashboard/student"},onError:e=>{var s,o;l.o.error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.message)||"Failed to switch role")}})}},22100:(e,s,o)=>{o.d(s,{A:()=>u,L:()=>l});var t=o(26715),r=o(95838),i=o(96918),n=o(35695),a=o(9282);let l=["/","/courses","/mentorship","/mentorship/*","/courses/*","/blog","/blog/*","/community","/community/*","/about","/contact","/auth/*","/course/*","/cookie-policy","/privacy-policy","/refund","/terms","/public-terms","/public-privacy","/public-refund","/public-cookies"];function u(){let e=(0,n.usePathname)(),s=(0,t.jE)(),o=l.some(s=>{if(s.endsWith("/*")){let o=s.slice(0,-2);return e===o||(null==e?void 0:e.startsWith(o+"/"))}return e===s}),{data:u,isLoading:d,error:c}=(0,r.I)({queryKey:a.ZF.session(),queryFn:async()=>{var e,t,r,n,l,u,d,c,v,h,m,y,p,f;try{let{data:s}=await i.A.get("/auth/me");return(null===(e=s.user)||void 0===e?void 0:e.id)?localStorage.setItem("userId",s.user.id):localStorage.removeItem("userId"),s}catch(e){if(localStorage.removeItem("userId"),(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:null===(t=r.message)||void 0===t?void 0:t.includes("Session invalidated"))||(null==e?void 0:null===(d=e.response)||void 0===d?void 0:null===(u=d.data)||void 0===u?void 0:null===(l=u.message)||void 0===l?void 0:l.includes("another device logged in")))return s.setQueryData(a.ZF.session(),{user:null}),o||(window.location.href="/auth/login"),{user:null};if((null==e?void 0:null===(c=e.response)||void 0===c?void 0:c.status)===401&&!o)try{await i.A.post("/auth/refresh");let{data:e}=await i.A.get("/auth/me");return e}catch(e){return((null==e?void 0:null===(m=e.response)||void 0===m?void 0:null===(h=m.data)||void 0===h?void 0:null===(v=h.message)||void 0===v?void 0:v.includes("Session invalidated"))||(null==e?void 0:null===(f=e.response)||void 0===f?void 0:null===(p=f.data)||void 0===p?void 0:null===(y=p.message)||void 0===y?void 0:y.includes("another device logged in")))&&(s.setQueryData(a.ZF.session(),{user:null}),o||(window.location.href="/auth/login")),{user:null}}if(o)return{user:null};throw e}},retry:!1,staleTime:3e4,gcTime:3e5,refetchInterval:!o&&6e4,refetchOnWindowFocus:!o,refetchOnMount:!0,refetchOnReconnect:!0,networkMode:"online"});return{user:(null==u?void 0:u.user)||null,isLoading:d,error:c,isAuthenticated:!!(null==u?void 0:u.user),isPublicPath:o,refetch:()=>s.invalidateQueries({queryKey:a.ZF.session()})}}},77915:(e,s,o)=>{o.d(s,{ZF:()=>a});var t=o(12115),r=o(34477);let i=(0,r.createServerReference)("0009fb4c1be73553ac24deed971bb2276e3c0f9950",r.callServer,void 0,r.findSourceMapURL,"getServerSession"),n=o(23464).A.create({baseURL:"http://localhost:8000/api",withCredentials:!0}),a={session:()=>["auth","session"],user:()=>["auth","user"]};(0,t.cache)(async()=>{try{if(!(await i()).user)return{user:null};let{data:e}=await n.get("/auth/me");return{user:e.user}}catch(e){return console.error("Error fetching session:",e),{user:null}}})},96918:(e,s,o)=>{o.d(s,{A:()=>u,F:()=>a});var t=o(23464),r=o(22100);let i="https://api.dugsiiye.com/api",n=null,a=t.A.create({baseURL:i,headers:{"Content-Type":"application/json"},withCredentials:!0}),l=async()=>(n||(n=(async()=>{try{return(await t.A.get("".concat(i,"/csrf-token"),{withCredentials:!0})).data.csrfToken}catch(r){if(t.A.isAxiosError(r)){var e,s,o;console.error("Failed to fetch CSRF token:",{status:null===(e=r.response)||void 0===e?void 0:e.status,message:(null===(o=r.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.message)||r.message})}else console.error("Failed to fetch CSRF token:",r);return n=null,null}})()),n);a.interceptors.request.use(async e=>{var s;if(["POST","PUT","DELETE","PATCH"].includes((null===(s=e.method)||void 0===s?void 0:s.toUpperCase())||"")){let s=await l();s&&(e.headers["X-CSRF-Token"]=s)}e.headers=e.headers||{};{let s=localStorage.getItem("sessionId");s&&!e.headers["X-Session-ID"]&&(e.headers["X-Session-ID"]=s)}return e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,async e=>{var s,o,t,i,u,d,c,v;let h=e.config;if(!h)return Promise.reject(e);let m=(null===(s=h.url)||void 0===s?void 0:s.includes("/auth/"))&&!(null===(o=h.url)||void 0===o?void 0:o.endsWith("/me")),y=window.location.pathname,p=r.L.some(e=>{if(e.endsWith("/*")){let s=e.slice(0,-2);return y===s||y.startsWith(s+"/")}return y===e}),f="/terms"===y||"/privacy-policy"===y||"/refund"===y||"/cookie-policy"===y||"/public-terms"===y||"/public-privacy"===y||"/public-refund"===y||"/public-cookies"===y;if((null===(t=e.response)||void 0===t?void 0:t.status)===403&&(null===(d=e.response)||void 0===d?void 0:null===(u=d.data)||void 0===u?void 0:null===(i=u.message)||void 0===i?void 0:i.includes("CSRF")))return n=null,Promise.reject(e);if((null===(c=e.response)||void 0===c?void 0:c.status)===401&&!m){if(f)return Promise.reject(e);if(!p||(null===(v=h.url)||void 0===v?void 0:v.endsWith("/me")))try{if((await a.post("/auth/refresh",{},{withCredentials:!0,headers:{"X-CSRF-Token":await l()}})).data.success)return a(h)}catch(e){if(!p&&!f){localStorage.removeItem("sessionId");let e=window.location.pathname+window.location.search,s="/auth/login?callbackUrl=".concat(encodeURIComponent(e));window.location.href=s}return Promise.reject(e)}}return Promise.reject(e)});let u=a}}]);